package net.augustus.modules.exploit;

import net.augustus.events.EventReadPacket;
import net.augustus.events.EventSendPacket;
import net.augustus.events.EventUpdate;
import net.augustus.events.EventWorld;
import net.augustus.modules.Categorys;
import net.augustus.modules.Module;
import net.augustus.settings.BooleanValue;
import net.augustus.utils.skid.vestige.LogUtil;
import net.augustus.utils.skid.xylitol.PacketUtil;
import net.lenni0451.eventapi.reflection.EventTarget;
import net.minecraft.client.Minecraft;
import net.minecraft.network.Packet;
import net.minecraft.network.play.client.C03PacketPlayer;
import net.minecraft.network.play.client.C0DPacketCloseWindow;
import net.minecraft.network.play.server.S08PacketPlayerPosLook;
import net.minecraft.network.play.server.S12PacketEntityVelocity;

import java.awt.*;

public class Intave13Fly extends Module {


    public Intave13Fly() {
        super("Intave13Fly", Color.white, Categorys.EXPLOIT);

    }
    public BooleanValue debug = new BooleanValue(9737,"Debug",this,true);
    public BooleanValue disOnWorld = new BooleanValue(10091,"DisableOnWorld",this,true);
    @Override
    public void onEnable() {
        super.onEnable();

    }

    @Override
    public void onDisable() {
        super.onDisable();
        mc.getTimer().timerSpeed = 1f;
    }
    @EventTarget
    public void onWorld(EventWorld eventWorld) {
        if (disOnWorld.getBoolean()) {
            this.setToggled(false);
        }
    }
    @EventTarget
    public void onEventUpdate(EventUpdate eventUpdate) {
        mc.getTimer().timerSpeed = 0.05f;
        if (mc.thePlayer.motionY < 0) {
            mc.thePlayer.motionY = -1.1;
            if (debug.getBoolean()) {
                LogUtil.addChatMessage("§F[§6OldIntaveFly§F]§F[§5Debug§F] MotionY = -1.1 .");
            }
        }
    }
    @EventTarget
    public void onEventReadPacket(EventReadPacket event) {
        Packet packet = event.getPacket();
        if (packet instanceof S12PacketEntityVelocity) {
            event.setCancelled(true);
            if (debug.getBoolean()) {
                LogUtil.addChatMessage("§F[§6OldIntaveFly§F]§F[§5Debug§F] Cancelled S12.");
            }
        }
        if (packet instanceof S08PacketPlayerPosLook) {
            S08PacketPlayerPosLook s08Packet = (S08PacketPlayerPosLook) packet;
            Minecraft mc = Minecraft.getMinecraft();
            if (mc.thePlayer == null || mc.thePlayer.ticksExisted <= 0) return;

            double x = s08Packet.getX() - mc.thePlayer.posX;
            double y = s08Packet.getY() - mc.thePlayer.posY;
            double z = s08Packet.getZ() - mc.thePlayer.posZ;
            double diff = Math.sqrt(x * x + y * y + z * z);

            if (diff <= 20) {
                event.setCancelled(true);
                sendPacketNoEvent(new C03PacketPlayer.C06PacketPlayerPosLook(
                        s08Packet.getX(),
                        s08Packet.getY(),
                        s08Packet.getZ(),
                        s08Packet.getYaw(),
                        s08Packet.getPitch(),
                        true
                ));
                if (debug.getBoolean()) {
                    LogUtil.addChatMessage("§F[§6OldIntaveFly§F]§F[§5Debug§F] §4ShotBow-§fModified C06.");
                }

                sendPacketNoEvent(new C03PacketPlayer.C04PacketPlayerPosition(
                        mc.thePlayer.posX,
                        mc.thePlayer.posY + 0.2,
                        mc.thePlayer.posZ,
                        false

                ));
                if (debug.getBoolean()) {
                    LogUtil.addChatMessage("§F[§6OldIntaveFly§F]§F[§5Debug§F] §4ShotBow-§fSend a NoEvent Y+0.2 notOnGround C04.");
                }
                sendPacketNoEvent(new C03PacketPlayer.C04PacketPlayerPosition(
                        mc.thePlayer.posX,
                        mc.thePlayer.posY,
                        mc.thePlayer.posZ,
                        true

                ));
                if (debug.getBoolean()) {
                    LogUtil.addChatMessage("§F[§6OldIntaveFly§F]§F[§5Debug§F] §4ShotBow-§fSend a NoEvent resetY OnGround C04.");
                }
                if (debug.getBoolean()) {
                    LogUtil.addChatMessage("§F[§6OldIntaveFly§F]§F[§5Debug§F] §4ShotBow-§fCancelled a C04.");
                }
            }
        }
    }
    @EventTarget
    public void onEventSendPacket(EventSendPacket event) {
        Object packet = event.getPacket();
        if (packet instanceof C0DPacketCloseWindow) {
            event.setCancelled(true);
            if (debug.getBoolean()) {
                LogUtil.addChatMessage("§F[§6OldIntaveFly§F]§F[§5Debug§F] §4ShotBow-§2Activated§f ShotBow Disabler!");
            }
        }
        if (packet instanceof C03PacketPlayer) {
            ((C03PacketPlayer) packet).setOnGround(true);
            if (debug.getBoolean()) {
                LogUtil.addChatMessage("§F[§6OldIntaveFly§F]§F[§5Debug§F] §4ShotBow-§fSet C03 OnGround.");
            }
        }

    }

    private void sendPacketNoEvent(C03PacketPlayer packet) {
        PacketUtil.sendPacketNoEvent(packet);
    }






}
